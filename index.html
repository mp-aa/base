<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBSTU Physics Alumni Association</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: 'Inter', sans-serif; }
    .nav-container {
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    .nav-container::-webkit-scrollbar { display: none; }
    
    /* Map styles */
    #alumni-map {
        border-radius: 0.5rem;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    /* Custom marker styles */
    .custom-marker {
        background: white;
        border: 3px solid;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        overflow: hidden;
    }
    
    .marker-bangladesh { border-color: #10b981; }
    .marker-international { border-color: #f59e0b; }
    
    /* Loading spinner */
    .loading-spinner {
        border: 4px solid #f3f4f6;
        border-top: 4px solid #7c3aed;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Professional gradient backgrounds for cards */
    .card-gradient-1 { background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%); }
    .card-gradient-2 { background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%); }
    .card-gradient-3 { background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%); }
    .card-gradient-4 { background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%); }
    .card-gradient-5 { background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%); }
    .card-gradient-6 { background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); }
</style>
</head>
<body class="bg-gray-100 text-gray-800">

<!-- Header and Navigation -->
<div class="bg-white shadow-md">
    <div class="header text-center py-6 bg-gradient-to-r from-blue-700 via-indigo-800 to-purple-900 text-white">
        <div class="main-title text-4xl sm:text-5xl font-extrabold tracking-tight">MBSTU PHYSICS ALUMNI ASSOCIATION</div>
        <div class="university-name text-lg sm:text-xl font-semibold mt-1">MAWLANA BHASHANI SCIENCE AND TECHNOLOGY UNIVERSITY</div>
    </div>
    <nav class="nav bg-white shadow-sm sticky top-0 z-50">
        <div class="nav-container max-w-7xl mx-auto flex justify-start items-center space-x-2 sm:space-x-4 p-4 overflow-x-auto whitespace-nowrap">
            <a href="index.html" class="nav-tab text-purple-600 font-bold border-b-2 border-purple-600 px-3 py-2 rounded-md text-sm sm:text-base">Home</a>
            <a href="membership-form.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Become a Member</a>
            <a href="members.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Current Members</a>
            <a href="committee.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Committee</a>
            <a href="alumni-news.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Alumni News</a>
            <a href="activities.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Activities</a>
            <a href="upcoming-events.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Upcoming Events</a>
            <a href="admin.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Admin</a>
        </div>
    </nav>
</div>

<!-- Main Content Area -->
<div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 space-y-12">

    <!-- Hero Section -->
    <section class="hero text-white rounded-lg shadow-lg overflow-hidden" style="background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop'); background-size: cover; background-position: center;">
        <div class="bg-black bg-opacity-60 aspect-[4/1] flex items-center justify-center px-4">
            <div class="text-center">
                <h1 class="text-2xl sm:text-3xl lg:text-4xl font-extrabold tracking-tight">Connecting Our Physics Graduates Worldwide</h1>
                <p class="mt-3 text-base sm:text-lg text-gray-300 max-w-2xl mx-auto"> MBSTU Physics Alumni Association unites graduates from home and abroad ‚Äî across education, banking, IT, public service, research, and beyond ‚Äî to uplift one another, share opportunities, and carry forward MBSTU Physics.</p>
                <a href="membership-form.html" class="mt-6 inline-block bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105">
                    Join Our Community
                </a>
            </div>
        </div>
    </section>

    <!-- Our Purpose Section -->
    <section>
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-3xl font-bold text-purple-800 mb-8 text-center">Our Purpose</h2>
            <p class="text-center text-gray-600 mb-10 max-w-3xl mx-auto">
                To build a stronger community of MBSTU Physics alumni - fostering professional growth, inspiring innovation, and promoting social responsibility toward the progress of Bangladesh.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Networking -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl p-6 text-center shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                    <div class="w-full flex justify-center gap-3 mx-auto mb-4 text-4xl">
                        <span>üîç</span>
                        <span>üï∏Ô∏è</span>
                        <span>üí°</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Networking</h3>
                    <p class="text-gray-600 text-sm">
                        Building a strong network among MBSTU Physics graduates in Bangladesh and abroad ‚Äî from classrooms to careers ‚Äî to share experience and open doors to new possibilities.
                    </p>
                </div>
                
                <!-- Career Guidance -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl p-6 text-center shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                    <div class="w-full flex justify-center gap-3 mx-auto mb-4 text-4xl">
                        <span>üíº</span>
                        <span>üë®üèª‚Äç‚úàÔ∏è</span>
                        <span>üéì</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Career Guidance</h3>
                    <p class="text-gray-600 text-sm">
                        Helping members prepare for professional success ‚Äî whether in public service, teaching, research, banking, or the private sector ‚Äî through mentorship, resources, and peer support.
                    </p>
                </div>
                
                <!-- Workshops -->
                <div class="bg-gradient-to-br from-amber-50 to-orange-100 rounded-xl p-6 text-center shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                    <div class="w-full flex justify-center gap-3 mx-auto mb-4 text-4xl">
                        <span>üë®üèª‚Äçüíª</span>
                        <span>üë®üèª‚Äç‚úà</span>
                        <span>üë®‚Äçüéì</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Workshops</h3>
                    <p class="text-gray-600 text-sm">
                        Hosting practical sessions on career development, skill enhancement, and professional readiness to help alumni thrive in competitive job markets and higher education at home and abroad.
                    </p>
                </div>
                
                <!-- Social Responsibility -->
                <div class="bg-gradient-to-br from-red-50 to-pink-100 rounded-xl p-6 text-center shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                    <div class="w-full flex justify-center gap-3 mx-auto mb-4 text-4xl">
                        <span>üå±</span>
                        <span>‚òéÔ∏è</span>
                        <span>‚õëÔ∏è</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Social Responsibility</h3>
                    <p class="text-gray-600 text-sm">
                        Standing beside the community through charity, disaster response, and educational initiatives ‚Äî reflecting the values of unity, empathy, and service.
                    </p>
                </div>
            </div>
            
            <!-- Get-together Section -->
            <div class="mt-12 bg-gradient-to-r from-purple-100 to-blue-100 rounded-xl p-8 text-center shadow-md">
                <div class="flex flex-col items-center">
                    <div class="w-full flex justify-center gap-4 mx-auto mb-4 text-4xl">
                        <span>ü§ù</span>
                        <span>‚òï</span>
                        <span>‚öΩ</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Get-together Events</h3>
                    <p class="text-gray-600 max-w-2xl mx-auto">
                        Reunion programs, friendly sports, and cultural nights that keep alumni connected ‚Äî celebrating shared memories and professional achievements across generations.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Member Statistics Section -->
    <section>
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-3xl font-bold text-purple-800 mb-8 text-center">Alumni Statistics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-center text-white shadow-lg">
                    <div class="text-3xl font-bold mb-2" id="total-members">0</div>
                    <div class="text-sm opacity-90">Total Members</div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-center text-white shadow-lg">
                    <div class="text-3xl font-bold mb-2" id="current-students">0</div>
                    <div class="text-sm opacity-90">Current Students</div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-center text-white shadow-lg">
                    <div class="text-3xl font-bold mb-2" id="working-professionals">0</div>
                    <div class="text-sm opacity-90">Working Professionals</div>
                </div>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-center text-white shadow-lg">
                    <div class="text-3xl font-bold mb-2" id="abroad-members">0</div>
                    <div class="text-sm opacity-90">Members Abroad</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Alumni Maps Section -->
    <section>
        <div class="bg-white shadow-lg rounded-lg p-6 space-y-4">
            <h2 class="text-3xl font-bold text-purple-800 mb-4 text-center">Alumni Worldwide Network</h2>
            <p class="text-center text-gray-600 mb-6">Discover where our MBSTU Physics graduates are building their careers worldwide.</p>
            
            <!-- Map Controls -->
            <div class="flex flex-wrap gap-4 justify-center mb-4">
                <button onclick="showAllAlumni()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition duration-300">
                    Show All Alumni
                </button>
                <button onclick="showBangladeshAlumni()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300">
                    Bangladesh Only
                </button>
                <button onclick="showInternationalAlumni()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition duration-300">
                    International Only
                </button>
            </div>
            
            <!-- Loading Spinner -->
            <div id="map-loading" class="text-center py-8">
                <div class="loading-spinner"></div>
                <p class="text-gray-600 mt-4">Loading alumni map...</p>
            </div>
            
            <!-- Leaflet Map Container -->
            <div id="alumni-map" class="w-full h-[500px] rounded-md overflow-hidden hidden">
                <!-- Map will be loaded here -->
            </div>
            
            <div class="flex flex-wrap gap-4 justify-center mt-4">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                    <span class="text-sm text-gray-600">Current Students</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-purple-500 rounded-full"></div>
                    <span class="text-sm text-gray-600">Working Professionals</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                    <span class="text-sm text-gray-600">Faculty & Researchers</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                    <span class="text-sm text-gray-600">International Alumni</span>
                </div>
            </div>
            
            <p class="text-center text-sm text-gray-500 mt-4" id="map-count">
                Loading alumni locations...
            </p>
        </div>
    </section>

    <!-- News & Activities Section -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Latest News -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-200 pb-2">Latest News</h3>
            <div id="news-list" class="space-y-4">
                <div class="p-4 rounded-md bg-gray-50 hover:bg-gray-100 transition">
                    <p class="font-semibold text-purple-700">Alumni Meet 2024</p>
                    <p class="text-sm text-gray-600">Annual gathering scheduled for December 2024</p>
                </div>
                <div class="p-4 rounded-md bg-gray-50 hover:bg-gray-100 transition">
                    <p class="font-semibold text-purple-700">Career Workshop</p>
                    <p class="text-sm text-gray-600">Upcoming career guidance session for final year students</p>
                </div>
            </div>
        </div>

        <!-- Upcoming Activities -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-200 pb-2">Upcoming Activities</h3>
            <div id="activities-list" class="space-y-4">
                <div class="p-4 rounded-md bg-gray-50 hover:bg-gray-100 transition">
                    <p class="font-semibold text-purple-700">Physics Olympiad</p>
                    <p class="text-sm text-gray-600">Inter-university competition next month</p>
                    <p class="text-xs text-gray-500 mt-1">Date: 15th November 2024</p>
                </div>
                <div class="p-4 rounded-md bg-gray-50 hover:bg-gray-100 transition">
                    <p class="font-semibold text-purple-700">Research Symposium</p>
                    <p class="text-sm text-gray-600">Showcasing alumni research projects</p>
                    <p class="text-xs text-gray-500 mt-1">Date: 30th November 2024</p>
                </div>
            </div>
        </div>
    </section>

</div>

<!-- Footer -->
<footer class="bg-gradient-to-r from-blue-700 via-indigo-800 to-purple-900 text-white text-center p-6 mt-8">
    <p class="font-semibold">&copy; 2024 MBSTU Physics Alumni Association. All Rights Reserved.</p>
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Your Google Apps Script URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwp_sGD3hxl3R6EwZEqzaUGbr8ovV286a3y8TiYbH8PmLW4oazW191NG-pjdFfH2mle/exec';
    const CACHE_KEY = 'alumni_map_cache';
    const CACHE_DURATION = 6 * 60 * 60 * 1000; // 6 hours

    let map, markers = [], allAlumniData = [], geocodingCache = {};

    // Bangladesh bounds
    const bangladeshBounds = [[20.5, 88.0], [26.5, 92.5]];

    // Common Bangladesh locations
    const bangladeshLocations = {
        'dhaka': [23.8103, 90.4125], 'tangail': [24.2513, 89.9167],
        'chattogram': [22.3569, 91.7832], 'sylhet': [24.8949, 91.8687],
        'khulna': [22.8456, 89.5403], 'rajshahi': [24.3745, 88.6042],
        'barishal': [22.7010, 90.3535], 'rangpur': [25.7439, 89.2752],
        'mymensingh': [24.7471, 90.4203], 'comilla': [23.4682, 91.1782],
        'gazipur': [24.0022, 90.4264], 'narayanganj': [23.6238, 90.4960]
    };

    // Initialize when page loads
    document.addEventListener("DOMContentLoaded", function() {
        updateStatistics();
        initMap();
    });

    // --- MEMBER STATISTICS ---
    function updateStatistics() {
        // These would ideally come from your Google Apps Script
        // For now, using sample data
        document.getElementById('total-members').textContent = '127';
        document.getElementById('current-students').textContent = '23';
        document.getElementById('working-professionals').textContent = '89';
        document.getElementById('abroad-members').textContent = '15';
    }

    // --- MAP FUNCTIONS ---
    function initMap() {
        // Show loading
        document.getElementById('map-loading').classList.remove('hidden');
        document.getElementById('alumni-map').classList.add('hidden');

        // Load cached data or fetch new
        const cached = getCachedData();
        if (cached) {
            console.log('Using cached data');
            allAlumniData = cached.data;
            geocodingCache = cached.geocodingCache;
            initializeLeafletMap();
        } else {
            loadAlumniData();
        }
    }

    function getCachedData() {
        try {
            const cached = localStorage.getItem(CACHE_KEY);
            if (!cached) return null;
            const parsed = JSON.parse(cached);
            if (Date.now() - parsed.timestamp > CACHE_DURATION) {
                localStorage.removeItem(CACHE_KEY);
                return null;
            }
            return parsed;
        } catch (e) {
            return null;
        }
    }

    function saveToCache(data, geocodingCache) {
        try {
            const cacheData = {
                data: data,
                geocodingCache: geocodingCache,
                timestamp: Date.now()
            };
            localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
        } catch (e) {
            console.warn('Failed to save cache');
        }
    }

    function loadAlumniData() {
        document.getElementById('map-count').textContent = 'Loading alumni data...';
        
        const oldScript = document.getElementById('jsonp-script');
        if (oldScript) oldScript.remove();
        
        window.handleAlumniData = function(data) {
            if (data.error) {
                console.error('Error:', data.error);
                loadSampleData();
                return;
            }
            console.log('Live data received:', data);
            allAlumniData = data.approved || [];
            document.getElementById('map-count').textContent = `Processing ${allAlumniData.length} alumni locations...`;
            processAlumniLocations();
        };
        
        const script = document.createElement('script');
        script.id = 'jsonp-script';
        script.src = SCRIPT_URL + '?callback=handleAlumniData';
        script.onerror = () => {
            console.error('Failed to load live data');
            loadSampleData();
        };
        document.head.appendChild(script);
    }

    async function processAlumniLocations() {
        for (const member of allAlumniData) {
            try {
                const locationQuery = getLocationQuery(member);
                if (locationQuery) {
                    const coordinates = await geocodeLocation(locationQuery);
                    member.coordinates = coordinates;
                    member.locationQuery = locationQuery;
                } else {
                    member.coordinates = [24.2513, 89.9167];
                    member.locationQuery = 'MBSTU, Tangail';
                }
                await new Promise(resolve => setTimeout(resolve, 50));
            } catch (error) {
                console.error(`Error processing ${member.name}:`, error);
                member.coordinates = [24.2513, 89.9167];
                member.locationQuery = 'MBSTU, Tangail';
            }
        }
        
        saveToCache(allAlumniData, geocodingCache);
        initializeLeafletMap();
    }

    function getLocationQuery(member) {
        if (member.workCity && member.workCountry) return `${member.workCity}, ${member.workCountry}`;
        if (member.workCity) return `${member.workCity}, Bangladesh`;
        if (member.district && member.subDistrict) return `${member.subDistrict}, ${member.district}, Bangladesh`;
        if (member.district) return `${member.district}, Bangladesh`;
        if (member.workCountry) return member.workCountry;
        return null;
    }

    async function geocodeLocation(query) {
        if (geocodingCache[query]) {
            return geocodingCache[query];
        }
        
        const bangladeshMatch = Object.keys(bangladeshLocations).find(location => 
            query.toLowerCase().includes(location.toLowerCase())
        );
        
        if (bangladeshMatch) {
            const coords = bangladeshLocations[bangladeshMatch];
            const randomizedCoords = [
                coords[0] + (Math.random() - 0.5) * 0.02,
                coords[1] + (Math.random() - 0.5) * 0.02
            ];
            geocodingCache[query] = randomizedCoords;
            return randomizedCoords;
        }
        
        try {
            const response = await fetch(
                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`
            );
            const data = await response.json();
            if (data && data.length > 0) {
                const coords = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                geocodingCache[query] = coords;
                return coords;
            }
        } catch (error) {
            console.warn(`Geocoding failed for "${query}"`);
        }
        
        // Fallback coordinates
        const hash = query.split('').reduce((a, b) => {
            a = ((a << 5) - a) + b.charCodeAt(0);
            return a & a;
        }, 0);
        
        const coords = [
            24.2513 + (hash % 100) / 1000 - 0.05,
            89.9167 + ((hash * 7) % 100) / 1000 - 0.05
        ];
        
        geocodingCache[query] = coords;
        return coords;
    }

    function initializeLeafletMap() {
        // Hide loading, show map
        document.getElementById('map-loading').classList.add('hidden');
        document.getElementById('alumni-map').classList.remove('hidden');

        // Create map centered on MBSTU
        map = L.map('alumni-map').setView([23.8103, 90.4125], 7);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        renderAllMarkers();
    }

    function createCustomIcon(isBangladesh, memberName) {
        const colorClass = isBangladesh ? 'marker-bangladesh' : 'marker-international';
        const initials = memberName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        
        const htmlContent = `
            <div class="w-full h-full rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center text-white font-bold text-sm">
                ${initials}
            </div>
        `;

        return L.divIcon({
            className: 'custom-marker ' + colorClass,
            html: htmlContent,
            iconSize: [48, 48],
            iconAnchor: [24, 48],
            popupAnchor: [0, -48]
        });
    }

    function renderAllMarkers() {
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        allAlumniData.forEach(member => {
            if (!member.coordinates) return;
            
            const isBangladesh = isInBangladesh(member);
            const icon = createCustomIcon(isBangladesh, member.name);
            const marker = L.marker(member.coordinates, { icon: icon }).addTo(map);
            
            const googleMapsLink = `https://www.google.com/maps?q=${member.coordinates[0]},${member.coordinates[1]}`;
            
            const popupContent = `
                <div style="min-width: 220px; padding: 12px;">
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; margin-right: 12px;">
                            ${member.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2)}
                        </div>
                        <div>
                            <h3 style="margin: 0 0 4px 0; color: #1f2937; font-weight: bold; font-size: 16px;">${member.name}</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 14px;">${member.profession || 'Alumni'}</p>
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
                        <p style="margin: 4px 0; color: #374151; font-size: 14px;"><strong>Batch:</strong> ${member.batch || 'N/A'}</p>
                        <p style="margin: 4px 0; color: #374151; font-size: 14px;"><strong>Location:</strong> ${member.locationQuery || 'Not specified'}</p>
                        ${member.company ? `<p style="margin: 4px 0; color: #374151; font-size: 14px;"><strong>Company:</strong> ${member.company}</p>` : ''}
                        
                        <div style="display: inline-flex; align-items: center; padding: 4px 8px; background: #f1f5f9; border-radius: 4px; font-size: 12px; margin-top: 8px;">
                            <span style="margin-right: 8px;">${isBangladesh ? 'üáßüá© Bangladesh' : 'üåç International'}</span>
                            <a href="${googleMapsLink}" target="_blank" style="color: #3b82f6; text-decoration: none; font-size: 12px; margin-left: 8px;">View on Maps</a>
                        </div>
                    </div>
                </div>
            `;
            
            marker.bindPopup(popupContent);
            markers.push(marker);
        });

        updateMapCount('all');
        
        if (markers.length > 0) {
            map.fitBounds(getAllBounds());
        }
    }

    function isInBangladesh(member) {
        const locationQuery = member.locationQuery || '';
        return locationQuery.toLowerCase().includes('bangladesh');
    }

    // Filter functions
    function showAllAlumni() {
        markers.forEach(marker => map.addLayer(marker));
        if (markers.length > 0) map.fitBounds(getAllBounds());
        updateMapCount('all');
    }

    function showBangladeshAlumni() {
        const bangladeshMarkers = markers.filter(marker => {
            const content = marker.getPopup().getContent();
            return content.includes('üáßüá© Bangladesh');
        });
        
        markers.forEach(marker => map.removeLayer(marker));
        bangladeshMarkers.forEach(marker => map.addLayer(marker));
        
        if (bangladeshMarkers.length > 0) {
            map.fitBounds(bangladeshBounds);
        }
        updateMapCount('bangladesh');
    }

    function showInternationalAlumni() {
        const internationalMarkers = markers.filter(marker => {
            const content = marker.getPopup().getContent();
            return content.includes('üåç International');
        });
        
        markers.forEach(marker => map.removeLayer(marker));
        internationalMarkers.forEach(marker => map.addLayer(marker));
        
        if (internationalMarkers.length > 0) {
            const group = new L.featureGroup(internationalMarkers);
            const bounds = group.getBounds();
            if (bounds.isValid()) map.fitBounds(bounds);
        }
        updateMapCount('international');
    }

    function updateMapCount(filter) {
        const total = allAlumniData.length;
        const bangladeshCount = allAlumniData.filter(member => isInBangladesh(member)).length;
        const internationalCount = total - bangladeshCount;

        let countText = '';
        if (filter === 'all') {
            countText = `Showing all ${total} alumni (${bangladeshCount} in Bangladesh, ${internationalCount} international)`;
        } else if (filter === 'bangladesh') {
            countText = `Showing ${bangladeshCount} alumni in Bangladesh`;
        } else if (filter === 'international') {
            countText = `Showing ${internationalCount} international alumni`;
        }

        document.getElementById('map-count').textContent = countText;
    }

    function getAllBounds() {
        const group = new L.featureGroup(markers);
        return group.getBounds();
    }

    function loadSampleData() {
        allAlumniData = [
            {
                name: "Dr. Ahmed Rahman",
                batch: "2009",
                profession: "Professor",
                company: "University of Dhaka",
                workCity: "Dhaka",
                workCountry: "Bangladesh"
            },
            {
                name: "Fatima Begum",
                batch: "2015", 
                profession: "Software Engineer",
                company: "Google LLC",
                workCity: "California",
                workCountry: "USA"
            }
        ];
        processAlumniLocations();
    }
</script>

</body>
</html>
