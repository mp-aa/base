<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBSTU Physics Alumni - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-md">
        <div class="header text-center py-6 bg-gradient-to-r from-blue-700 via-indigo-800 to-purple-900 text-white">
            <div class="main-title text-4xl sm:text-5xl font-extrabold tracking-tight">MBSTU PHYSICS ALUMNI ASSOCIATION</div>
            <div class="university-name text-lg sm:text-xl font-semibold mt-1">MAWLANA BHASHANI SCIENCE AND TECHNOLOGY UNIVERSITY</div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-purple-800 mb-6">Admin Dashboard</h1>
        
        <div class="mb-6">
            <button onclick="loadData()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-semibold">
                Refresh Data
            </button>
            <span id="status" class="ml-4 text-gray-600">Click refresh to load data</span>
        </div>

        <!-- Pending Applications -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Pending Applications</h2>
            <div id="pending-applications" class="space-y-4">
                <div class="text-center py-8 text-gray-500">No data loaded yet</div>
            </div>
        </div>

        <!-- Approved Members -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Approved Members</h2>
            <div id="approved-members" class="space-y-4">
                <div class="text-center py-8 text-gray-500">No data loaded yet</div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwWxhBaak1E8R-YcNqishdQMI_m5KsTHQ8NUfl2b8WGarrVVK6LDmvc1bh6RWXyk47O/exec';

        // JSONP method to load data
        function loadData() {
            document.getElementById('status').textContent = 'Loading data...';
            
            // Remove any existing script
            const oldScript = document.getElementById('jsonp-script');
            if (oldScript) oldScript.remove();
            
            // Create script tag for JSONP
            const script = document.createElement('script');
            script.id = 'jsonp-script';
            script.src = SCRIPT_URL + '?callback=handleData';
            document.head.appendChild(script);
        }

        // Handle JSONP response
        function handleData(data) {
            if (data.error) {
                document.getElementById('status').textContent = 'Error: ' + data.error;
                return;
            }
            
            displayPendingApplications(data.pending || []);
            displayApprovedMembers(data.approved || []);
            document.getElementById('status').textContent = `Loaded ${data.pending?.length || 0} pending, ${data.approved?.length || 0} approved`;
        }

        function displayPendingApplications(applications) {
            const container = document.getElementById('pending-applications');
            
            if (applications.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No pending applications</div>';
                return;
            }
            
            container.innerHTML = applications.map(app => `
                <div class="border border-gray-200 rounded-lg p-6 bg-white shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-xl text-gray-800 mb-2">${app.name}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <p><strong>Email:</strong> ${app.email}</p>
                                    <p><strong>Phone:</strong> ${app.phone}</p>
                                    <p><strong>Batch:</strong> ${app.batch}</p>
                                </div>
                                <div>
                                    <p><strong>Student ID:</strong> ${app.studentId}</p>
                                    <p><strong>Status:</strong> <span class="text-orange-600 font-medium">${app.status}</span></p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 ml-4">
                            <button onclick="approveApplication(${app.row})" 
                                    class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 font-medium">
                                Approve
                            </button>
                            <button onclick="rejectApplication(${app.row})" 
                                    class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 font-medium">
                                Deny
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayApprovedMembers(members) {
            const container = document.getElementById('approved-members');
            
            if (members.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No approved members</div>';
                return;
            }
            
            container.innerHTML = members.map(member => `
                <div class="border border-gray-200 rounded-lg p-6 bg-white shadow-sm">
                    <div class="flex-1">
                        <h3 class="font-semibold text-xl text-gray-800 mb-2">${member.name}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                            <div>
                                <p><strong>Email:</strong> ${member.email}</p>
                                <p><strong>Phone:</strong> ${member.phone}</p>
                                <p><strong>Batch:</strong> ${member.batch}</p>
                            </div>
                            <div>
                                <p><strong>Student ID:</strong> ${member.studentId}</p>
                                <p><strong>Status:</strong> <span class="text-green-600 font-medium">âœ“ Approved</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function approveApplication(row) {
            if (confirm('Approve this application?')) {
                // For POST, we'll use a simple form submission
                updateStatus(row, 'approved');
            }
        }

        function rejectApplication(row) {
            if (confirm('Reject this application?')) {
                updateStatus(row, 'rejected');
            }
        }

        // Simple form submission for POST requests
        function updateStatus(row, status) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = SCRIPT_URL;
            form.target = 'hiddenFrame';
            form.style.display = 'none';
            
            const rowInput = document.createElement('input');
            rowInput.name = 'row';
            rowInput.value = row;
            
            const statusInput = document.createElement('input');
            statusInput.name = 'status';
            statusInput.value = status;
            
            form.appendChild(rowInput);
            form.appendChild(statusInput);
            document.body.appendChild(form);
            
            // Create hidden iframe for response
            let iframe = document.getElementById('hiddenFrame');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.id = 'hiddenFrame';
                iframe.name = 'hiddenFrame';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }
            
            form.submit();
            
            setTimeout(() => {
                document.body.removeChild(form);
                alert('Status updated successfully!');
                loadData(); // Refresh data
            }, 1000);
        }

        // Load data on page load
        loadData();
    </script>
</body>
</html>
