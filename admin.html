<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBSTU Physics Alumni - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-md">
        <div class="header text-center py-6 bg-gradient-to-r from-blue-700 via-indigo-800 to-purple-900 text-white">
            <div class="main-title text-4xl sm:text-5xl font-extrabold tracking-tight">MBSTU PHYSICS ALUMNI ASSOCIATION</div>
            <div class="university-name text-lg sm:text-xl font-semibold mt-1">MAWLANA BHASHANI SCIENCE AND TECHNOLOGY UNIVERSITY</div>
        </div>
        <nav class="nav bg-white shadow-sm">
            <div class="nav-container max-w-7xl mx-auto flex justify-center items-center space-x-2 sm:space-x-4 p-4 overflow-x-auto whitespace-nowrap">
                <a href="index.html" class="nav-tab text-purple-600 font-bold border-b-2 border-purple-600 px-3 py-2 rounded-md text-sm sm:text-base">Home</a>
                <a href="membership-form.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Become a Member</a>
                <a href="members.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Current Members</a>
                <a href="admin.html" class="nav-tab text-gray-600 hover:text-purple-600 transition duration-300 px-3 py-2 rounded-md text-sm sm:text-base font-medium">Admin</a>
            </div>
        </nav>
    </div>

    <!-- Admin Panel -->
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-purple-800 mb-6">Admin Dashboard</h1>
        
        <div class="mb-6">
            <button onclick="loadData()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-semibold">
                Refresh Data
            </button>
            <span id="status" class="ml-4 text-gray-600">Click refresh to load data</span>
        </div>

        <!-- Pending Applications -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Pending Applications</h2>
            <div id="pending-applications" class="space-y-4">
                <div class="text-center py-8 text-gray-500">No data loaded yet</div>
            </div>
        </div>

        <!-- Approved Members -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Approved Members</h2>
            <div id="approved-members" class="space-y-4">
                <div class="text-center py-8 text-gray-500">No data loaded yet</div>
            </div>
        </div>
    </div>

    <footer class="bg-gradient-to-r from-blue-700 via-indigo-800 to-purple-900 text-white text-center p-6 mt-16">
        <p class="font-semibold">&copy; 2024 MBSTU Physics Alumni Association. All Rights Reserved.</p>
    </footer>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwWxhBaak1E8R-YcNqishdQMI_m5KsTHQ8NUfl2b8WGarrVVK6LDmvc1bh6RWXyk47O/exec';

        async function loadData() {
            document.getElementById('status').textContent = 'Loading data...';
            
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('status').textContent = 'Error: ' + data.error;
                    return;
                }
                
                displayPendingApplications(data.pending || []);
                displayApprovedMembers(data.approved || []);
                document.getElementById('status').textContent = `Loaded ${data.pending?.length || 0} pending, ${data.approved?.length || 0} approved`;
                
            } catch (error) {
                document.getElementById('status').textContent = 'Error loading data: ' + error.message;
                console.error('Error:', error);
            }
        }

        function displayPendingApplications(applications) {
            const container = document.getElementById('pending-applications');
            
            if (applications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-lg">No pending applications</p>
                        <p class="text-sm mt-2">All applications have been processed</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = applications.map(app => `
                <div class="border border-gray-200 rounded-lg p-6 bg-white shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-xl text-gray-800 mb-2">${app.name}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <p><strong>Email:</strong> ${app.email}</p>
                                    <p><strong>Phone:</strong> ${app.phone}</p>
                                    <p><strong>Batch:</strong> ${app.batch}</p>
                                </div>
                                <div>
                                    <p><strong>Student ID:</strong> ${app.studentId}</p>
                                    <p><strong>Status:</strong> <span class="text-orange-600 font-medium">${app.status}</span></p>
                                    <p><strong>Row:</strong> ${app.row}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 ml-4">
                            <button onclick="approveApplication(${app.row})" 
                                    class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 font-medium">
                                Approve
                            </button>
                            <button onclick="rejectApplication(${app.row})" 
                                    class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 font-medium">
                                Deny
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayApprovedMembers(members) {
            const container = document.getElementById('approved-members');
            
            if (members.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-lg">No approved members</p>
                        <p class="text-sm mt-2">Approve some applications to see members here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = members.map(member => `
                <div class="border border-gray-200 rounded-lg p-6 bg-white shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-xl text-gray-800 mb-2">${member.name}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                                <div>
                                    <p><strong>Email:</strong> ${member.email}</p>
                                    <p><strong>Phone:</strong> ${member.phone}</p>
                                    <p><strong>Batch:</strong> ${member.batch}</p>
                                </div>
                                <div>
                                    <p><strong>Student ID:</strong> ${member.studentId}</p>
                                    <p><strong>Status:</strong> <span class="text-green-600 font-medium">âœ“ Approved</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function approveApplication(row) {
            if (!confirm('Are you sure you want to approve this application?')) return;
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        row: row,
                        status: 'approved'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Application approved successfully!');
                    loadData(); // Refresh data
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error approving application: ' + error.message);
            }
        }

        async function rejectApplication(row) {
            if (!confirm('Are you sure you want to reject this application?')) return;
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        row: row,
                        status: 'rejected'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Application rejected successfully!');
                    loadData(); // Refresh data
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error rejecting application: ' + error.message);
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
